{% import "_form.html" as form %}
{% import "_content.html" as content %}
{% extends "_layout.html" %}

{% block content %}
  <form
    action="/bookmarks/create"
    method="POST"
    class="flex flex-col max-w-xl mx-4 mb-4 grow"
    hx-post="/bookmarks/create"
    hx-target="main"
    hx-select="main"
    hx-push-url="true"
    id="create_bookmark"
  >
    <header class="mt-3 mb-4">
      <h1 class="text-xl font-bold">Add a bookmark</h1>
    </header>

    <label for="url">URL</label>
    {% call form::errors(errors, "url") %}
    <input
      type="text"
      name="url"
      placeholder="https://..."
      required
      value="{{ input.url }}"
      {# TODO move all labels 1 unit closer to inputs #}
      class="rounded py-1.5 px-3 mt-2 bg-neutral-900"
    />

    <label for="title" class="mt-4">Title </label>
    {% call form::errors(errors, "title") %}
    <input
      type="text"
      name="title"
      required
      value="{{ input.title }}"
      class="rounded py-1.5 px-3 mt-2 bg-neutral-900"
    />

    <label for="note_search_term" class="mt-4">Add to Note </label>
    {% match selected_parent %}
      {% when Some with (note) %}
      <a
        class="leading-8 text-fuchsia-100 hover:text-fuchsia-300"
        href="{{ note.path() }}"
      >
        Ô∏èüßµ {{ note.title }}
      </a>
      <input type="hidden" name="parent" value="{{ note.id }}" />
      {% when None %}
      {% call form::errors(errors, "note_search_term") %}
      <input
        type="search"
        name="note_search_term"
        id="note_search_term"
        value="{{ input.note_search_term.as_deref().unwrap_or_default() }}"
        hx-trigger="input changed delay:300ms,search"
        hx-post="/bookmarks/create"
        class="rounded py-1.5 px-3 mt-2 bg-neutral-900"
      />
      <div id="search_results">
        {% for note in search_results %}
          <button
            hx-post="/bookmarks/create"
            class="block w-full px-4 pt-1 pb-2 text-left rounded hover:bg-neutral-700 text-fuchsia-100"
            value="{{ note.id }}"
            name="parent"
          >
            Ô∏èüßµ {{ note.title }}
          </button>
        {% endfor %}
      </div>
    {% endmatch %}
    {% call form::errors(errors, "root") %}
    <button
      type="submit"
      name="submitted"
      value="true"
      class="bg-neutral-300 py-1.5 px-3 text-neutral-900 rounded mt-4 self-end"
    >
      Add Bookmark
    </button>
  </form>
{% endblock %}
