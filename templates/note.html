{% extends "_layout.html" %}
{% block content %}
  <header class="px-4 pt-3 pb-4">
    <div class="flex justify-between items-center">
      <h1 class="text-xl font-bold">{{ note.title }}</h1>

      <ul>
        <li>
          <a
            href="/bookmarks/create?parent_id={{ note.id }}"
            class="hover:bg-neutral-700 rounded px-4 py-1"
            hx-get="/bookmarks/create?parent_id={{ note.id }}"
            hx-select="#create_bookmark"
            hx-target="#create_bookmark_slot"
            >Add bookmark</a
          >
        </li>
      </ul>
    </div>
    {% if let Some(content) = note.content %}
      <p class="mt-2">{{- content -}}</p>
    {% endif %}
  </header>

  <div id="create_bookmark_slot" class="flex justify-center"></div>

  {% for link in links %}
    <section class="px-4 py-4 border-t border-neutral-700">
      {% match link.dest %}
        {% when db::LinkDestinationWithChildren::Note with (note) %}
        <h2 class="font-semibold">
          <a
            class="block hover:text-fuchsia-300"
            href="/notes/{{ note.note.id }}"
          >
            {{ note.note.title }}
          </a>
        </h2>
        {% if let Some(content) = note.note.content %}
          <p class="mt-2">{{- content -}}</p>
        {%- endif -%}

        {%- if note.links.len() > 0 -%}
          <ul class="mt-2">
            {% for link in note.links %}
              {%- match link -%}
                {%- when db::LinkDestination::Bookmark with (bookmark) -%}
                <li class="my-2">
                  <a
                    class="block leading-8 text-orange-100 hover:text-orange-300"
                    href="{{ bookmark.url }}"
                  >
                    üìÑ {{ bookmark.title }} ‚Üí
                  </a>
                  <p class="text-sm text-neutral-500">
                    {{ bookmark.url|truncate(25) }}
                  </p>
                </li>
                {%- when db::LinkDestination::Note with (note) -%}
                <li class="my-2">
                  <a
                    class="block leading-8 text-fuchsia-100 hover:text-fuchsia-300"
                    href="/notes/{{ note.id }}"
                  >
                    Ô∏èüßµ {{ note.title }} ‚Üí
                  </a>
                </li>
                {% when _ %}
              {% endmatch %}
            {% endfor %}
          </ul>
        {% endif %}
        {% when db::LinkDestinationWithChildren::Bookmark with (bookmark) %}
        <a
          class="block leading-8 text-orange-100 hover:text-orange-300"
          href="{{ bookmark.url }}"
        >
          üìÑ {{ bookmark.title }} ‚Üí
        </a>
        <p class="text-sm text-neutral-500">{{ bookmark.url|truncate(25) }}</p>
      {% endmatch %}
    </section>
  {% endfor %}
{% endblock %}
